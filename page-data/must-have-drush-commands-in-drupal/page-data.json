{"componentChunkName":"component---src-templates-blog-post-js","path":"/must-have-drush-commands-in-drupal/","result":{"data":{"markdownRemark":{"html":"<p>I am working on a project where we use Drush commands a lot .... seriously like A LOT.. That said, while working on the project, I found few drush commands which come quite handy in our day to day operations. We use these commands mostly with deploy hooks and also while working locally.</p>\n<p>Everyone uses Drush commands which are kinda in daily use while working on Drupal and we just canâ€™t imagine our life without it in terms of increasing our productivity.</p>\n<p>We want to be more and more productive right? Yes, we do. :)</p>\n<h2 id=\"a-little-bit-about-drush\">A little bit about Drush</h2>\n<p>Drush is an awesome command line shell and Unix scripting interface for Drupal. It is a very useful tool and its core ships with lots of useful commands for interacting with code like modules/themes/profiles. It does a lot of things like running update.php, executes sql queries and DB migrations, run cron or clear cache etc.</p>\n<p>Even Though there are a bunch of commands available and can be found <a href=\"https://drushcommands.com/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">here</a>, which are continuously making our lives easier, we still feel the urge to have custom Drush commands that suits our project needs and can improve overall team efficiency.</p>\n<p>Creating custom Drush commands is very easy, Drupal provides hooks to integrate with our custom modules. Infact, there is not much difference between creating custom Drush commands with Drupal 7/ Drupal 8.</p>\n<h2 id=\"coming-back-to-this-post\">Coming back to this post</h2>\n<p>Here I am gonna mention few custom Drush commands which can be really handy while working on a project and can save plenty of your time.</p>\n<p>Following are the things we should have automated using Drush commands:</p>\n<ul>\n<li>Database checks: This includes checking the number of threats with respect to the database, as if any unwanted module is enabled, PHP filter, ensuring errors and warnings are off etc.</li>\n<li>Clearing specific cache: This is useful when we would like to target a specific cid and bin using cache<em>clear</em>all() via the Drush command.</li>\n<li>Rebuilding theme (This is not similar to clearing theme-registry): There is no option as of now to rebuild theme when we add CSS or JS files in a themes .info file.</li>\n</ul>\n<h2 id=\"database-checks\">Database checks</h2>\n<p>The first step, we need is to call the hook provided by Drupal. This is required to define the description of the hook, defining an alias with an example.</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token comment\">/**\n * Implements drush_command().\n */</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">my_module_drush_command</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token variable\">$items</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token variable\">$items</span><span class=\"token punctuation\">[</span><span class=\"token single-quoted-string string\">'my-module-run-db-checks'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token single-quoted-string string\">'description'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token single-quoted-string string\">'Checking potential issues on the database to ensure it is production ready.'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token single-quoted-string string\">'callback'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token single-quoted-string string\">'my_module_run_db_checks'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token single-quoted-string string\">'examples'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">[</span>\n      <span class=\"token single-quoted-string string\">'drush my-module-db-checks'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token single-quoted-string string\">'Run few database checks on the respected target.'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token single-quoted-string string\">'aliases'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">[</span><span class=\"token single-quoted-string string\">'my-module-run-db-checks'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token variable\">$items</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Now what is required is to create the callback function with whatever things we want to check to ensure that there isn't any potential threat to the system. Following are the things we must have:</p>\n<ul>\n<li>Checking if PHP Errors and warnings are off.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token comment\">/**\n * Run an audit against a database to check for potential issues.\n */</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">my_module_run_db_checks</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token variable\">$errors</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Hide all PHP errors.</span>\n  <span class=\"token variable\">$er_query</span> <span class=\"token operator\">=</span> <span class=\"token function\">db_query</span><span class=\"token punctuation\">(</span><span class=\"token double-quoted-string string\">\"SELECT CONVERT( value\n    USING utf8 ) AS error_reporting_level\n    FROM variable\n    WHERE name = 'error_level'\n    LIMIT 0 , 30\n  \"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token variable\">$record</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$er_query</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">fetchObject</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token variable\">$error_level</span> <span class=\"token operator\">=</span> <span class=\"token function\">unserialize</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$record</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token property\">error_reporting_level</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$error_level</span> <span class=\"token operator\">!==</span> <span class=\"token double-quoted-string string\">\"0\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token variable\">$errors</span><span class=\"token punctuation\">[</span><span class=\"token single-quoted-string string\">'php_errors_visible'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token single-quoted-string string\">'PHP errors are not hidden. Errors will be visible on the site.'</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// Check if there is any error found.</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">empty</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$errors</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">drush_log</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'DB checks completed. No problems were found.'</span><span class=\"token punctuation\">,</span> <span class=\"token single-quoted-string string\">'success'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">drush_log</span><span class=\"token punctuation\">(</span><span class=\"token double-quoted-string string\">\"\\nThe following issues were found with this site:\"</span><span class=\"token punctuation\">,</span> <span class=\"token single-quoted-string string\">'error'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">foreach</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$errors</span> <span class=\"token keyword\">as</span> <span class=\"token variable\">$key</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token variable\">$value</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">drush_log</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'- '</span> <span class=\"token punctuation\">.</span> <span class=\"token variable\">$value</span><span class=\"token punctuation\">,</span> <span class=\"token single-quoted-string string\">'error'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>Checking if all the unnecessary modules (For example: Devel, Since XSS vulnerabilities are the #1 vulnerability found in Drupal 7 contrib modules, it's always recommended to disable the 'devel' module on production sites and (if possible) entirely remove it.) are disabled. (We will just add the following to the above callback, also we can easily add more modules the list).</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token comment\">// Check if stage file proxy isn't enabled.</span>\n<span class=\"token variable\">$sfp_status_query</span> <span class=\"token operator\">=</span> <span class=\"token function\">db_select</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'system'</span><span class=\"token punctuation\">,</span> <span class=\"token single-quoted-string string\">'s'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">fields</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'s'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token single-quoted-string string\">'name'</span><span class=\"token punctuation\">,</span> <span class=\"token single-quoted-string string\">'status'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n  <span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">condition</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'s.name'</span><span class=\"token punctuation\">,</span> <span class=\"token single-quoted-string string\">'stage_file_proxy'</span><span class=\"token punctuation\">,</span> <span class=\"token single-quoted-string string\">'='</span><span class=\"token punctuation\">)</span>\n  <span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">execute</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">fetchAssoc</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$sfp_status_query</span><span class=\"token punctuation\">[</span><span class=\"token single-quoted-string string\">'status'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">===</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token variable\">$errors</span><span class=\"token punctuation\">[</span><span class=\"token single-quoted-string string\">'dblog_enabled'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token single-quoted-string string\">'Stage file proxy module is still enabled.'</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// Check if database logging isn't enabled.</span>\n<span class=\"token variable\">$dblog_status_query</span> <span class=\"token operator\">=</span> <span class=\"token function\">db_select</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'system'</span><span class=\"token punctuation\">,</span> <span class=\"token single-quoted-string string\">'s'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">fields</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'s'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token single-quoted-string string\">'name'</span><span class=\"token punctuation\">,</span> <span class=\"token single-quoted-string string\">'status'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n  <span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">condition</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'s.name'</span><span class=\"token punctuation\">,</span> <span class=\"token single-quoted-string string\">'dblog'</span><span class=\"token punctuation\">,</span> <span class=\"token single-quoted-string string\">'='</span><span class=\"token punctuation\">)</span>\n  <span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">execute</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">fetchAssoc</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$dblog_status_query</span><span class=\"token punctuation\">[</span><span class=\"token single-quoted-string string\">'status'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">===</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token variable\">$errors</span><span class=\"token punctuation\">[</span><span class=\"token single-quoted-string string\">'dblog_enabled'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token single-quoted-string string\">'Database logging is still enabled. This will cause unnecessary read and write queries.'</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// Make sure 'devel' module isn't enabled.</span>\n<span class=\"token variable\">$devel_status_query</span> <span class=\"token operator\">=</span> <span class=\"token function\">db_select</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'system'</span><span class=\"token punctuation\">,</span> <span class=\"token single-quoted-string string\">'s'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">fields</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'s'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token single-quoted-string string\">'name'</span><span class=\"token punctuation\">,</span> <span class=\"token single-quoted-string string\">'status'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n  <span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">condition</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'s.name'</span><span class=\"token punctuation\">,</span> <span class=\"token single-quoted-string string\">'devel'</span><span class=\"token punctuation\">,</span> <span class=\"token single-quoted-string string\">'='</span><span class=\"token punctuation\">)</span>\n  <span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">execute</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">fetchAssoc</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$devel_status_query</span><span class=\"token punctuation\">[</span><span class=\"token single-quoted-string string\">'status'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">===</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token variable\">$errors</span><span class=\"token punctuation\">[</span><span class=\"token single-quoted-string string\">'devel_module_enabled'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token single-quoted-string string\">'Devel module is still enabled.'</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>Checking if USER ID 1 is blocked or not. The Drupal account created during installation (i.e. with user ID or UID=1) behaves differently from others. Primarily, it can bypass all access callbacks: it has permission to do everything by default. Failing to secure this account could result in potential security risks. Treat the UID=1 account as you would with root on Linux systems.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token comment\">// Check User ID 1 is blocked.</span>\n<span class=\"token variable\">$user_status_query</span> <span class=\"token operator\">=</span> <span class=\"token function\">db_select</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'users'</span><span class=\"token punctuation\">,</span> <span class=\"token single-quoted-string string\">'u'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">fields</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'u'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token single-quoted-string string\">'uid'</span><span class=\"token punctuation\">,</span> <span class=\"token single-quoted-string string\">'status'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n  <span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">condition</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'u.uid'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token single-quoted-string string\">'='</span><span class=\"token punctuation\">)</span>\n  <span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">execute</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">fetchAssoc</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$user_status_query</span><span class=\"token punctuation\">[</span><span class=\"token single-quoted-string string\">'status'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">===</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token variable\">$errors</span><span class=\"token punctuation\">[</span><span class=\"token single-quoted-string string\">'user_id_1_enabled'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token single-quoted-string string\">'User ID 1 is still enabled. This account should be blocked for security reasons.'</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>Checking if PHP filter is enabled or not. There are a lot of downsides when we are using PHP filter and apparently, there is a pretty awesome explanation for that on this <a href=\"https://drupal.stackexchange.com/questions/2509/what-are-the-downsides-of-using-php-filter-code-in-blocks-nodes-views-args-et\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">post</a>.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token comment\">// PHP filter should not be enabled on any site.</span>\n<span class=\"token variable\">$php_filter_status_query</span> <span class=\"token operator\">=</span> <span class=\"token function\">db_select</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'filter_format'</span><span class=\"token punctuation\">,</span> <span class=\"token single-quoted-string string\">'f'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">fields</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'f'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token single-quoted-string string\">'format'</span><span class=\"token punctuation\">,</span> <span class=\"token single-quoted-string string\">'status'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n  <span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">condition</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'f.format'</span><span class=\"token punctuation\">,</span> <span class=\"token single-quoted-string string\">'php_code'</span><span class=\"token punctuation\">,</span> <span class=\"token single-quoted-string string\">'='</span><span class=\"token punctuation\">)</span>\n  <span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">execute</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">fetchAssoc</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$php_filter_status_query</span><span class=\"token punctuation\">[</span><span class=\"token single-quoted-string string\">'status'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">===</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token variable\">$errors</span><span class=\"token punctuation\">[</span><span class=\"token single-quoted-string string\">'php_filter_enabled'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token single-quoted-string string\">'The PHP filter is still enabled and could cause potential security issues.'</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>For all these checks, we just need to go to the terminal and run the following command:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">drush my-module-run-db-checks</code></pre></div>\n<h2 id=\"clearing-specific-cache\">Clearing specific cache</h2>\n<p>We need to follow the same step i.e. we need is to call the hook provided by Drupal for defining the command definition, description etc.</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token comment\">/**\n * Implements drush_command().\n */</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">my_module_drush_command</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token variable\">$items</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token variable\">$items</span><span class=\"token punctuation\">[</span><span class=\"token single-quoted-string string\">'my-module-cc-cache-bin'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token single-quoted-string string\">'description'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token single-quoted-string string\">'Clear a specific cache bin.'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token single-quoted-string string\">'callback'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token single-quoted-string string\">'my_module_cc_cache_bin'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token single-quoted-string string\">'examples'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">[</span>\n      <span class=\"token single-quoted-string string\">'drush my-module-cc-cb cid_you_want_to_clear cache_table'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token single-quoted-string string\">'Clear passed cid from passed table.'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token single-quoted-string string\">'arguments'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">[</span>\n      <span class=\"token single-quoted-string string\">'cid'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token function\">dt</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'CID for items to clear'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token single-quoted-string string\">'cache_bin'</span>   <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token function\">dt</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'A required cache bin argument.'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token single-quoted-string string\">'wildcard'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token function\">dt</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'Whether to do a wildcard delete'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token single-quoted-string string\">'aliases'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">[</span><span class=\"token single-quoted-string string\">'my-module-cc-cb'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token variable\">$items</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Now, we need to define the callback which will do the fun part:</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token comment\">/**\n * Exposes cache_clear_all to drush for deploy hooks.\n *\n * @param string|string[] $cid\n *   Cache id or array of cache ids to clear.\n * @param string $bin\n *   The bin name to clear.\n * @param bool $wildcard\n *   Default false, whether to use wildcard matching.\n */</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">my_module_cc_cache_bin</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$cid</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$bin</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$wildcard</span> <span class=\"token operator\">=</span> <span class=\"token boolean constant\">FALSE</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">cache_clear_all</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$cid</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$bin</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$wildcard</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">drush_log</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'Cleared cids: '</span> <span class=\"token punctuation\">.</span> <span class=\"token variable\">$cid</span> <span class=\"token punctuation\">.</span> <span class=\"token single-quoted-string string\">' in bin: '</span> <span class=\"token punctuation\">.</span> <span class=\"token variable\">$bin</span><span class=\"token punctuation\">,</span> <span class=\"token single-quoted-string string\">'ok'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>To clear cache id or array of cids from specific cache table, we just need to go to the terminal and run the following command:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">drush my-module-cc-cb cid_you_want_to_clear cache_table</code></pre></div>\n<h2 id=\"rebuilding-theme-data\">Rebuilding theme data</h2>\n<p>Since we know how to define an custom drush command, we can just skip to the callback directly. ;)</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token comment\">/**\n * Rebuilding theme data properly.\n */</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">my_module_rebuild_theme</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">system_rebuild_theme_data</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">drush_log</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'Theme data rebuilt.'</span><span class=\"token punctuation\">,</span> <span class=\"token single-quoted-string string\">'ok'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Now we can rebuild theme data easily with a custom drush command.</p>\n<blockquote>\n<p>Similarly, we can add custom Drush commands as per our use and project's need and obviously we can improvise the scripts, do additional work. This post covers important Drush commands which are essential in our day to day projects plus it also explains how we can create custom Drush commands, YAY BONUS!! :D</p>\n</blockquote>","fields":{"slug":"/must-have-drush-commands-in-drupal/"},"frontmatter":{"date":"16 January 2018","image":"/assets/img/","description":"This post explains how to create custom drush commands which are in must have list for every Drupal project","title":"Must have custom drush commands in every Drupal project"},"timeToRead":6}},"pageContext":{"slug":"/must-have-drush-commands-in-drupal/","previous":{"fields":{"slug":"/time-to-level-up-code-reviews/"},"frontmatter":{"title":"Time to level up Code Reviews","date":"16 October 2017"}},"next":{"fields":{"slug":"/drupal-camp-goa-2018-call-for-sessions/"},"frontmatter":{"title":"Emboss your footprints in the Drupal Sand - Drupal Camp Goa 2018, Call for sessions","date":"26 January 2018"}}}},"staticQueryHashes":["185390462","63159454","844308772"]}